<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title th:text="${pageTitle}">ê²°ê³¼</title>
  <link rel="stylesheet" href="/css/result.css" th:href="@{/css/result.css}" />
  <style>
  #height-value, #weight-value {display: none; }
  </style>
</head>
<body>
<div id="app">
  <!-- Header  -->
  <header id="header" class="store depth1">
    <div class="top">
      <div class="logo">
        <!-- &lt;!&ndash; ì´ë¯¸ì§€ ê²½ë¡œ ë°”ê¿”ì£¼ì„¸ìš” &ndash;&gt; -->
        <a href="#" onclick="window.location.href='http://localhost:9080'">
          <img th:src="@{/img/black-yagiyo.png}" alt="" src="/" />
        </a>
      </div>
      <div class="search_box">
        <input
            class="searchbar"
            type="text"
            placeholder="ì˜ì–‘ì œ ì„±ë¶„ ê²€ìƒ‰ì„ í•´ë³´ì„¸ìš” ğŸ’Š "
        />
        <div class="search_btn">
          <!-- &lt;!&ndash; ì´ë¯¸ì§€ ê²½ë¡œ ë°”ê¿”ì£¼ì„¸ìš” &ndash;&gt; -->
          <img th:src="@{/img/search_div_icn.png}" alt="" />
        </div>
      </div>
      <nav class="gnb_box">
        <a href="">AIë¶„ì„</a>
        <a href="">ì»¤ë®¤ë‹ˆí‹°</a>
        <a href="">ì•½êµ­ì •ë³´</a>
        <a href="">ë¡œê·¸ì¸</a>
      </nav>
    </div>
  </header>
  <main id="surveyv3" class="surveyv3-result" role="main">
    <section class="result-top">
      <div class="inner">
        <h3 id="result-name">
          <span id="name-value"></span>ë‹˜ì˜ ê±´ê°•ì„¤ë¬¸ ê²°ê³¼ì…ë‹ˆë‹¤
        </h3>
        <dl>
          <dt>ì„±ë³„:</dt>
          <span id="gender-value"></span>
          ã…¤<dt>ë‚˜ì´:</dt>
          <span id="age-value"></span>
          <!-- Display BMI value -->
          ã…¤<dt class="open-bmi-layer">
          BMI:
        </dt>
          <span id="bmi-value"></span>
          <dd><span id="height-value"></span></dd>
          <dd><span id="weight-value"></span></dd>
        </dl>
        <div class="bmi-wrap">
          <div class="graph">
            <ul class="data">
              <li class="lv1">ì €ì²´ì¤‘</li>
              <li class="lv2" >ì •ìƒ</li>
              <li class="lv3">ê³¼ì²´ì¤‘</li>
              <li class="lv4">ë¹„ë§Œ</li>
              <li class="lv5">ê³ ë„ë¹„ë§Œ</li>
            </ul>
            <span class="dot" id="bmi-dot" style="display: block; margin-left: ${bmiDotPosition}%;"></span>
            <ul class="label">
              <li>&nbsp;</li>
              <li>18.5</li>
              <li>23</li>
              <li>25</li>
              <li>30</li>
            </ul>
          </div>
          <p>ì¢‹ì•„ìš”!</p>
        </div>
        <div class="recommend-wrap">
          <h4>ìƒí™œìŠµê´€ ê°œì„ ì´ í•„ìš”í•´ìš”</h4>
          <ul class="bullet-item"></ul>
        </div>
        <p>* ë³¸ ê²°ê³¼ëŠ” ì˜ì‚¬ì˜ ì²˜ë°©ì„ ëŒ€ì‹ í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</p>
      </div>
    </section>
    <nav class="survey-nav">
      <h2>
        ì¶”ì²œì˜ì–‘ì„±ë¶„
        <em>5</em>
      </h2>
      <ul>
        <li class="nav-item" data-id="omega3">
          <div class="img-wrap" style="background-color: #b1d9f2">
            <img src="/img/ì˜¤ë©”ê°€3.png" alt="" />
          </div>
          <div class="text-wrap">
            <p>ì˜¤ë©”ê°€3</p>
          </div>
        </li>
        <li class="nav-item" data-id="lutein">
          <div class="img-wrap" style="background-color: #f9d4bf">
            <img src="/img/ë£¨í…Œì¸.png" alt="" />
          </div>
          <div class="text-wrap">
            <p>ë£¨í…Œì¸</p>
          </div>
        </li>
        <li class="nav-item" data-id="hyals">
          <div class="img-wrap" style="background-color: #e9faff">
            <img src="/img/íˆì•Œë£¨ë¡ ì‚°.png" alt="" />
          </div>
          <div class="text-wrap">
            <p>íˆì•Œë£¨ë¡ ì‚° ìŠ¤í”¼ë£¨ë¦¬ë‚˜</p>
          </div>
        </li>
        <li class="nav-item" data-id="cj-fermentenzyme">
          <div class="img-wrap" style="background-color: #cccccc">
            <img src="/img/ë°œíš¨íš¨ì†Œ ë² ì´ì§.png" alt="" />
          </div>
          <div class="text-wrap">
            <p>ë°œíš¨íš¨ì†Œ ë² ì´ì§</p>
          </div>
        </li>
        </li>
        <li class="nav-item" data-id="theanine">
          <div class="img-wrap" style="background-color: #EBF5F5">
            <img src="/img/í…Œì•„ë‹Œ.png" alt="" />
          </div>
          <div class="text-wrap">
            <p>í…Œì•„ë‹Œ</p>
          </div>
        </li>
      </ul>
    </nav>
    <!--    ì˜ì–‘ì„±ë¶„ ë¶„ì„-->
    <section id="omega3" class="result-content omega3" data-title="ì˜¤ë©”ê°€3" data-color="#b1d9f2">
      <div class="inner">
        <div class="header result-content-header" data-color="#b1d9f2" style="background-color: rgba(177, 217, 242, 0.5);">
          <div class="left">
            <h4>ì˜¤ë©”ê°€3</h4>
            <ul>
              <li># í˜ˆì¤‘ì¤‘ì„±ì§€ë°© ê°œì„ ì— ë„ì›€</li>
              <br>
              <li># í˜ˆí–‰ ê°œì„ ì— ë„ì›€</li>
              <br>
              <li># ëˆˆ ê±´ê°•ì— ë„ì›€</li>
            </ul>
            <span> * 30ëŒ€ì´ˆë°˜ì˜ ë‚¨ì„± 67.32%ê°€ ì¶”ì²œë°›ì•˜ìŠµë‹ˆë‹¤.</span>
          </div>
          <div class="right">
            <ul class="tag">
              <li>
                <span class="icon icon-eye"></span>
                <p>ëˆˆ</p>
              </li>
              <li>
                <span class="icon icon-heart"></span>
                <p>í˜ˆì•¡ìˆœí™˜</p>
              </li>
            </ul>
            <div class="rating">
              <div class="progress" data="4.0">
                <canvas width="40" height="40"></canvas>
              </div>
              <span class="value">4.0</span>
            </div>
            <p class="rating-label">ì¶”ì²œì ìˆ˜</p>
          </div>
        </div>
        <div class="content">
          <h1>ì¶”ì²œ ì˜ì–‘ì œ</h1>
          <p>
            ë¶„ì„ ê²°ê³¼ë¥¼ í† ëŒ€ë¡œ ì¶”ì²œí•˜ëŠ” ì˜ì–‘ì œì…ë‹ˆë‹¤. ìì„¸í•œ ë‚´ìš©ì´ ê¶ê¸ˆí•˜ë‹¤ë©´ ì œí’ˆì„ í´ë¦­í•´ì£¼ì„¸ìš”
          </p>
          <ul id="result">
            <li>
              <span id="illness-value"></span>
              <a href="https://search.shopping.naver.com/catalog/21839321494?query=%EC%98%A4%EB%A9%94%EA%B0%803&NaPm=ct%3Dlgk86zo0%7Cci%3Daab56bbae994c01b9c17472b65b8e5df198d71a6%7Ctr%3Dslsl%7Csn%3D95694%7Chk%3D07a53635ea041363f45bacdbe51195011f956f24">
                <img src="/img/í”„ë¡œë©”ê°€ì˜¤ë©”ê°€3.jpg" alt="" width="100" height="100">
              </a>
            </li>
          </ul>
        </div>
        <div class="content"></div>
        <div class="food"></div>
        <div class="footer omega3"></div>
      </div>
    </section>
  </main>
  <footer>í‘¸í„°</footer>
</div>
<script>
      function getUrlParameter(name) {
        name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
        var regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
        var results = regex.exec(location.search);
        return results === null
          ? ''
          : decodeURIComponent(results[1].replace(/\+/g, ' '));
      }
      window.onload = function () {
        let nameInput = decodeURIComponent(getUrlParameter('name'));
        let genderInput = decodeURIComponent(getUrlParameter('gender'));
        let ageInput = decodeURIComponent(getUrlParameter('age'));
        let illnessInput = decodeURIComponent(getUrlParameter('illness'));
        let heightInput = decodeURIComponent(getUrlParameter('height'));
        let weightInput = decodeURIComponent(getUrlParameter('weight'));
        let bmiInput = decodeURIComponent(getUrlParameter('bmi'));
        let bmiDotInput = decodeURIComponent(getUrlParameter('bmiDot'));

        let nameValue = document.getElementById('name-value');
        let genderValue = document.getElementById('gender-value');
        let ageValue = document.getElementById('age-value');
        let illnessValue = document.getElementById('illness-value');
        let heightValue = document.getElementById('height-value');
        let weightValue = document.getElementById('weight-value');
        let bmiValue = parseFloat(
          document.querySelector('#bmi-value').textContent,
        );
        //bmiDot
        const bmiDot = document.getElementById('bmi-dot'); // bmi-dot ìš”ì†Œ ê°€ì ¸ì˜¤ê¸°
        let bmiDotPosition;

        if (bmiDotInput < 18.5) {
          bmiDotPosition = (bmiDotInput - 0) / (18.5 - 0) * 20;
        } else if (bmiDotInput >= 18.5 && bmiDotInput < 23) {
          bmiDotPosition = (bmiDotInput - 18.5) / (23 - 18.5) * 20 + 20;
        } else if (bmiDotInput >= 23 && bmiDotInput < 25) {
          bmiDotPosition = (bmiDotInput - 23) / (25 - 23) * 20 + 40;
        } else if (bmiDotInput >= 25 && bmiDotInput < 30) {
          bmiDotPosition = (bmiDotInput - 25) / (30 - 25) * 20 + 60;
        } else {
          bmiDotPosition = (bmiDotInput - 30) / (50 - 30) * 20 + 80;
        }
        bmiDot.style.marginLeft = `${bmiDotPosition}%`;

        document.getElementById('name-value').textContent = nameInput;
        document.getElementById('gender-value').textContent = genderInput;
        document.getElementById('age-value').textContent = ageInput;
        document.getElementById('illness-value').textContent = illnessInput;
        document.getElementById('height-value').textContent = heightInput;
        document.getElementById('weight-value').textContent = weightInput;
        document.getElementById('bmi-value').textContent = bmiInput;

        // URLì—ì„œ BMI ê°’ì„ ì¶”ì¶œ
        const urlParams = new URLSearchParams(window.location.search);
        const bmi = urlParams.get('bmi') ? Number(urlParams.get('bmi')) : document.getElementById("bmi") ? Number(document.getElementById("bmi").textContent) : null;

        if (bmi < 18.5) {
          document.querySelector(".lv1").classList.add("active");
        } else if (bmi < 23) {
          document.querySelector(".lv2").classList.add("active");
        } else if (bmi < 25) {
          document.querySelector(".lv3").classList.add("active");
        } else if (bmi < 30) {
          document.querySelector(".lv4").classList.add("active");
        } else {
          document.querySelector(".lv5").classList.add("active");
        }

        if (
          nameValue &&
          genderValue &&
          ageValue &&
          illnessValue &&
          heightValue &&
          weightValue &&
          bmiValue
        ) {
          nameValue.textContent = nameInput;
          genderValue.textContent = genderInput;
          ageValue.textContent = ageInput;
          illnessValue.textContent = illnessInput;
          heightValue.textContent = heightInput;
          weightValue.textContent = weightInput;
          bmiValue.textContent = bmiInput;

          let urlParams = new URLSearchParams(window.location.search);
          let urlName = urlParams.get('name');
          let UrlGender = urlParams.get('gender');
          let UrlAge = urlParams.get('age');
          let UrlIllness = urlParams.get('illness');
          let UrlHeight = urlParams.get('height');
          let UrlWeight = urlParams.get('weight');
          let UrlBmi = urlParams.get('bmi');

          let bmiValueElement = document.getElementById('bmi-value');
          if (bmiValueElement && UrlBmi) {
            urlParams.set('bmi', UrlBmi); // update the URL with the original value
            bmiValueElement.textContent = UrlBmi;
          } else {
            console.error(
              'Element with ID "bmi-value" not found or BMI value not provided in URL!',
            );
          }
        }
      };
      const categoryInfo = {
        blood: 'í˜ˆì•¡ìˆœí™˜',
        digestion: 'ì†Œí™”/ì¥',
        skin: 'í”¼ë¶€',
        // Add more category-value pairs here
      };

      // ê²°ê³¼ë¥¼ ì¶œë ¥í•  ìœ„ì¹˜ë¥¼ ê°€ë¦¬í‚¤ëŠ” ìš”ì†Œë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.
      const resultElement = document.getElementById('illness-value');

      // ì¹´í…Œê³ ë¦¬ íŒŒë¼ë¯¸í„°ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.
      const urlParams = new URLSearchParams(window.location.search);
      const categoriesParam = urlParams.get('category');
      const categoryValues = categoriesParam ? categoriesParam.split(',') : [];

      // ê° ì¹´í…Œê³ ë¦¬ì— ëŒ€í•œ ì •ë³´ë¥¼ ìƒì„±í•˜ê³ , ê²°ê³¼ ìœ„ì¹˜ì— ì¶”ê°€í•©ë‹ˆë‹¤.
      categoryValues.forEach(category => {
        const categoryInfoElement = document.createElement('p');
        categoryInfoElement.textContent = categoryInfo[category];
        resultElement.appendChild(categoryInfoElement);
      });

    </script>
</body>
</html>
