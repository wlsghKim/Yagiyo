<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title th:text="${pageTitle}">결과</title>
  <link rel="stylesheet" href="/css/result.css" th:href="@{/css/result.css}" />
  <style>
  #height-value, #weight-value {display: none; }
  </style>
</head>
<body>
<div id="app">
  <!-- Header  -->
  <header id="header" class="store depth1">
    <div class="top">
      <div class="logo">
        <!-- &lt;!&ndash; 이미지 경로 바꿔주세요 &ndash;&gt; -->
        <a href="#" onclick="window.location.href='http://localhost:9080'">
          <img th:src="@{/img/black-yagiyo.png}" alt="" src="/" />
        </a>
      </div>
      <div class="search_box">
        <input
            class="searchbar"
            type="text"
            placeholder="영양제 성분 검색을 해보세요 💊 "
        />
        <div class="search_btn">
          <!-- &lt;!&ndash; 이미지 경로 바꿔주세요 &ndash;&gt; -->
          <img th:src="@{/img/search_div_icn.png}" alt="" />
        </div>
      </div>
      <nav class="gnb_box">
        <a href="">AI분석</a>
        <a href="">커뮤니티</a>
        <a href="">약국정보</a>
        <a href="">로그인</a>
      </nav>
    </div>
  </header>
  <main id="surveyv3" class="surveyv3-result" role="main">
    <section class="result-top">
      <div class="inner">
        <h3 id="result-name">
          <span id="name-value"></span>님의 건강설문 결과입니다
        </h3>
        <dl>
          <dt>성별:</dt>
          <span id="gender-value"></span>
          ㅤ<dt>나이:</dt>
          <span id="age-value"></span>
          <!-- Display BMI value -->
          ㅤ<dt class="open-bmi-layer">
          BMI:
        </dt>
          <span id="bmi-value"></span>
          <dd><span id="height-value"></span></dd>
          <dd><span id="weight-value"></span></dd>
        </dl>
        <div class="bmi-wrap">
          <div class="graph">
            <ul class="data">
              <li class="lv1">저체중</li>
              <li class="lv2" >정상</li>
              <li class="lv3">과체중</li>
              <li class="lv4">비만</li>
              <li class="lv5">고도비만</li>
            </ul>
            <span class="dot" id="bmi-dot" style="display: block; margin-left: ${bmiDotPosition}%;"></span>
            <ul class="label">
              <li>&nbsp;</li>
              <li>18.5</li>
              <li>23</li>
              <li>25</li>
              <li>30</li>
            </ul>
          </div>
          <p>좋아요!</p>
        </div>
        <div class="recommend-wrap">
          <h4>생활습관 개선이 필요해요</h4>
          <ul class="bullet-item"></ul>
        </div>
        <p>* 본 결과는 의사의 처방을 대신하지 않습니다.</p>
      </div>
    </section>
    <nav class="survey-nav">
      <h2>
        추천영양성분
        <em>5</em>
      </h2>
      <ul>
        <li class="nav-item" data-id="omega3">
          <div class="img-wrap" style="background-color: #b1d9f2">
            <img src="/img/오메가3.png" alt="" />
          </div>
          <div class="text-wrap">
            <p>오메가3</p>
          </div>
        </li>
        <li class="nav-item" data-id="lutein">
          <div class="img-wrap" style="background-color: #f9d4bf">
            <img src="/img/루테인.png" alt="" />
          </div>
          <div class="text-wrap">
            <p>루테인</p>
          </div>
        </li>
        <li class="nav-item" data-id="hyals">
          <div class="img-wrap" style="background-color: #e9faff">
            <img src="/img/히알루론산.png" alt="" />
          </div>
          <div class="text-wrap">
            <p>히알루론산 스피루리나</p>
          </div>
        </li>
        <li class="nav-item" data-id="cj-fermentenzyme">
          <div class="img-wrap" style="background-color: #cccccc">
            <img src="/img/발효효소 베이직.png" alt="" />
          </div>
          <div class="text-wrap">
            <p>발효효소 베이직</p>
          </div>
        </li>
        </li>
        <li class="nav-item" data-id="theanine">
          <div class="img-wrap" style="background-color: #EBF5F5">
            <img src="/img/테아닌.png" alt="" />
          </div>
          <div class="text-wrap">
            <p>테아닌</p>
          </div>
        </li>
      </ul>
    </nav>
    <!--    영양성분 분석-->
    <section id="omega3" class="result-content omega3" data-title="오메가3" data-color="#b1d9f2">
      <div class="inner">
        <div class="header result-content-header" data-color="#b1d9f2" style="background-color: rgba(177, 217, 242, 0.5);">
          <div class="left">
            <h4>오메가3</h4>
            <ul>
              <li># 혈중중성지방 개선에 도움</li>
              <br>
              <li># 혈행 개선에 도움</li>
              <br>
              <li># 눈 건강에 도움</li>
            </ul>
            <span> * 30대초반의 남성 67.32%가 추천받았습니다.</span>
          </div>
          <div class="right">
            <ul class="tag">
              <li>
                <span class="icon icon-eye"></span>
                <p>눈</p>
              </li>
              <li>
                <span class="icon icon-heart"></span>
                <p>혈액순환</p>
              </li>
            </ul>
            <div class="rating">
              <div class="progress" data="4.0">
                <canvas width="40" height="40"></canvas>
              </div>
              <span class="value">4.0</span>
            </div>
            <p class="rating-label">추천점수</p>
          </div>
        </div>
        <div class="content">
          <h1>추천 영양제</h1>
          <p>
            분석 결과를 토대로 추천하는 영양제입니다. 자세한 내용이 궁금하다면 제품을 클릭해주세요
          </p>
          <ul id="result">
            <li>
              <span id="illness-value"></span>
              <a href="https://search.shopping.naver.com/catalog/21839321494?query=%EC%98%A4%EB%A9%94%EA%B0%803&NaPm=ct%3Dlgk86zo0%7Cci%3Daab56bbae994c01b9c17472b65b8e5df198d71a6%7Ctr%3Dslsl%7Csn%3D95694%7Chk%3D07a53635ea041363f45bacdbe51195011f956f24">
                <img src="/img/프로메가오메가3.jpg" alt="" width="100" height="100">
              </a>
            </li>
          </ul>
        </div>
        <div class="content"></div>
        <div class="food"></div>
        <div class="footer omega3"></div>
      </div>
    </section>
  </main>
  <footer>푸터</footer>
</div>
<script>
      function getUrlParameter(name) {
        name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
        var regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
        var results = regex.exec(location.search);
        return results === null
          ? ''
          : decodeURIComponent(results[1].replace(/\+/g, ' '));
      }
      window.onload = function () {
        let nameInput = decodeURIComponent(getUrlParameter('name'));
        let genderInput = decodeURIComponent(getUrlParameter('gender'));
        let ageInput = decodeURIComponent(getUrlParameter('age'));
        let illnessInput = decodeURIComponent(getUrlParameter('illness'));
        let heightInput = decodeURIComponent(getUrlParameter('height'));
        let weightInput = decodeURIComponent(getUrlParameter('weight'));
        let bmiInput = decodeURIComponent(getUrlParameter('bmi'));
        let bmiDotInput = decodeURIComponent(getUrlParameter('bmiDot'));

        let nameValue = document.getElementById('name-value');
        let genderValue = document.getElementById('gender-value');
        let ageValue = document.getElementById('age-value');
        let illnessValue = document.getElementById('illness-value');
        let heightValue = document.getElementById('height-value');
        let weightValue = document.getElementById('weight-value');
        let bmiValue = parseFloat(
          document.querySelector('#bmi-value').textContent,
        );
        //bmiDot
        const bmiDot = document.getElementById('bmi-dot'); // bmi-dot 요소 가져오기
        let bmiDotPosition;

        if (bmiDotInput < 18.5) {
          bmiDotPosition = (bmiDotInput - 0) / (18.5 - 0) * 20;
        } else if (bmiDotInput >= 18.5 && bmiDotInput < 23) {
          bmiDotPosition = (bmiDotInput - 18.5) / (23 - 18.5) * 20 + 20;
        } else if (bmiDotInput >= 23 && bmiDotInput < 25) {
          bmiDotPosition = (bmiDotInput - 23) / (25 - 23) * 20 + 40;
        } else if (bmiDotInput >= 25 && bmiDotInput < 30) {
          bmiDotPosition = (bmiDotInput - 25) / (30 - 25) * 20 + 60;
        } else {
          bmiDotPosition = (bmiDotInput - 30) / (50 - 30) * 20 + 80;
        }
        bmiDot.style.marginLeft = `${bmiDotPosition}%`;

        document.getElementById('name-value').textContent = nameInput;
        document.getElementById('gender-value').textContent = genderInput;
        document.getElementById('age-value').textContent = ageInput;
        document.getElementById('illness-value').textContent = illnessInput;
        document.getElementById('height-value').textContent = heightInput;
        document.getElementById('weight-value').textContent = weightInput;
        document.getElementById('bmi-value').textContent = bmiInput;

        // URL에서 BMI 값을 추출
        const urlParams = new URLSearchParams(window.location.search);
        const bmi = urlParams.get('bmi') ? Number(urlParams.get('bmi')) : document.getElementById("bmi") ? Number(document.getElementById("bmi").textContent) : null;

        if (bmi < 18.5) {
          document.querySelector(".lv1").classList.add("active");
        } else if (bmi < 23) {
          document.querySelector(".lv2").classList.add("active");
        } else if (bmi < 25) {
          document.querySelector(".lv3").classList.add("active");
        } else if (bmi < 30) {
          document.querySelector(".lv4").classList.add("active");
        } else {
          document.querySelector(".lv5").classList.add("active");
        }

        if (
          nameValue &&
          genderValue &&
          ageValue &&
          illnessValue &&
          heightValue &&
          weightValue &&
          bmiValue
        ) {
          nameValue.textContent = nameInput;
          genderValue.textContent = genderInput;
          ageValue.textContent = ageInput;
          illnessValue.textContent = illnessInput;
          heightValue.textContent = heightInput;
          weightValue.textContent = weightInput;
          bmiValue.textContent = bmiInput;

          let urlParams = new URLSearchParams(window.location.search);
          let urlName = urlParams.get('name');
          let UrlGender = urlParams.get('gender');
          let UrlAge = urlParams.get('age');
          let UrlIllness = urlParams.get('illness');
          let UrlHeight = urlParams.get('height');
          let UrlWeight = urlParams.get('weight');
          let UrlBmi = urlParams.get('bmi');

          let bmiValueElement = document.getElementById('bmi-value');
          if (bmiValueElement && UrlBmi) {
            urlParams.set('bmi', UrlBmi); // update the URL with the original value
            bmiValueElement.textContent = UrlBmi;
          } else {
            console.error(
              'Element with ID "bmi-value" not found or BMI value not provided in URL!',
            );
          }
        }
      };
      const categoryInfo = {
        blood: '혈액순환',
        digestion: '소화/장',
        skin: '피부',
        // Add more category-value pairs here
      };

      // 결과를 출력할 위치를 가리키는 요소를 가져옵니다.
      const resultElement = document.getElementById('illness-value');

      // 카테고리 파라미터를 가져옵니다.
      const urlParams = new URLSearchParams(window.location.search);
      const categoriesParam = urlParams.get('category');
      const categoryValues = categoriesParam ? categoriesParam.split(',') : [];

      // 각 카테고리에 대한 정보를 생성하고, 결과 위치에 추가합니다.
      categoryValues.forEach(category => {
        const categoryInfoElement = document.createElement('p');
        categoryInfoElement.textContent = categoryInfo[category];
        resultElement.appendChild(categoryInfoElement);
      });

    </script>
</body>
</html>
